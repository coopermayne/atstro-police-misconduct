---
import MainLayout from '../../layouts/MainLayout.astro';
import DocumentsList from '../../components/DocumentsList.astro';
import { getCollection } from 'astro:content';

// Helper function to create slug from text
function createSlug(name: string): string {
  return name.toLowerCase().trim().replace(/\s+/g, '-');
}

export async function getStaticPaths() {
  const cases = await getCollection('cases');
  return cases.map(caseItem => ({
    params: { slug: caseItem.slug },
    props: { caseItem },
  }));
}

const { caseItem } = Astro.props;
const { Content } = await caseItem.render();
---

<MainLayout content={{ title: caseItem.data.title }}>
  <article class="px-6 py-8">
    <!-- Breadcrumb -->
    <nav class="text-sm text-gray-600 dark:text-gray-400 mb-6">
      <a href="/" class="hover:text-red-600 dark:hover:text-red-500">Home</a>
      <span class="mx-2">/</span>
      <a href="/cases" class="hover:text-red-600 dark:hover:text-red-500">Cases</a>
      <span class="mx-2">/</span>
      <span class="text-gray-800 dark:text-gray-300">{caseItem.data.case_id}</span>
    </nav>

    <!-- Case Header -->
    <header class="bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 p-8 mb-8">
      <div class="mb-4">
        <span class="text-sm text-gray-500 dark:text-gray-400">Case ID: {caseItem.data.case_id}</span>
      </div>
      
      <h1 class="text-3xl lg:text-4xl font-semibold text-gray-800 dark:text-white mb-6 border-b-2 border-red-600 pb-4">
        {caseItem.data.title}
      </h1>

      <!-- Metadata Grid -->
      <div class="grid md:grid-cols-2 gap-8 text-sm">
        <div>
          <h3 class="font-semibold text-gray-800 dark:text-white mb-3 text-base">Victim Information</h3>
          <dl class="space-y-2">
            <div>
              <dt class="text-gray-600 dark:text-gray-400 inline">Name:</dt>
              <dd class="inline ml-2 font-medium text-gray-800 dark:text-gray-200">{caseItem.data.victim_name}</dd>
            </div>
            {caseItem.data.age && (
              <div>
                <dt class="text-gray-600 dark:text-gray-400 inline">Age:</dt>
                <dd class="inline ml-2 text-gray-800 dark:text-gray-200">{caseItem.data.age}</dd>
              </div>
            )}
            {caseItem.data.race && (
              <div>
                <dt class="text-gray-600 dark:text-gray-400 inline">Race:</dt>
                <dd class="inline ml-2 text-gray-800 dark:text-gray-200">{caseItem.data.race}</dd>
              </div>
            )}
            {caseItem.data.gender && (
              <div>
                <dt class="text-gray-600 dark:text-gray-400 inline">Gender:</dt>
                <dd class="inline ml-2 text-gray-800 dark:text-gray-200">{caseItem.data.gender}</dd>
              </div>
            )}
          </dl>
        </div>

        <div>
          <h3 class="font-semibold text-gray-800 dark:text-white mb-3 text-base">Incident Details</h3>
          <dl class="space-y-2">
            <div>
              <dt class="text-gray-600 dark:text-gray-400 inline">Date:</dt>
              <dd class="inline ml-2 text-gray-800 dark:text-gray-200">{new Date(caseItem.data.incident_date).toLocaleDateString()}</dd>
            </div>
            <div>
              <dt class="text-gray-600 dark:text-gray-400 inline">Location:</dt>
              <dd class="inline ml-2 text-gray-800 dark:text-gray-200">
                {caseItem.data.city}, <a href={`/counties/${createSlug(caseItem.data.county)}`} class="text-red-600 dark:text-red-500 hover:underline">{caseItem.data.county} County</a>
              </dd>
            </div>
            {caseItem.data.cause_of_death && (
              <div>
                <dt class="text-gray-600 dark:text-gray-400 inline">Cause of Death:</dt>
                <dd class="inline ml-2 text-gray-800 dark:text-gray-200">{caseItem.data.cause_of_death}</dd>
              </div>
            )}
            {caseItem.data.armed_status && (
              <div>
                <dt class="text-gray-600 dark:text-gray-400 inline">Armed Status:</dt>
                <dd class="inline ml-2 text-gray-800 dark:text-gray-200">{caseItem.data.armed_status}</dd>
              </div>
            )}
          </dl>
        </div>

        <div>
          <h3 class="font-semibold text-gray-800 dark:text-white mb-3 text-base">Agencies Involved</h3>
          <div class="flex flex-wrap gap-2">
            {caseItem.data.agencies.map(agency => (
              <a href={`/agencies/${createSlug(agency)}`} class="px-3 py-1 bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 rounded hover:bg-red-200 dark:hover:bg-red-800 transition-colors">
                {agency}
              </a>
            ))}
          </div>
        </div>

        <div>
          <h3 class="font-semibold text-gray-800 dark:text-white mb-3 text-base">Status</h3>
          <dl class="space-y-2">
            <div>
              <dt class="text-gray-600 dark:text-gray-400 inline">Investigation:</dt>
              <dd class="inline ml-2">
                <a href={`/status/${createSlug(caseItem.data.investigation_status)}`} class="text-red-600 dark:text-red-500 hover:underline">
                  {caseItem.data.investigation_status}
                </a>
              </dd>
            </div>
            <div>
              <dt class="text-gray-600 dark:text-gray-400 inline">Charges Filed:</dt>
              <dd class="inline ml-2 text-gray-800 dark:text-gray-200">{caseItem.data.charges_filed ? 'Yes' : 'No'}</dd>
            </div>
            <div>
              <dt class="text-gray-600 dark:text-gray-400 inline">Civil Lawsuit:</dt>
              <dd class="inline ml-2 text-gray-800 dark:text-gray-200">{caseItem.data.civil_lawsuit_filed ? 'Yes' : 'No'}</dd>
            </div>
            {caseItem.data.bodycam_available && (
              <div>
                <dt class="text-gray-600 dark:text-gray-400 inline">Body Camera:</dt>
                <dd class="inline ml-2 text-green-600 dark:text-green-400">Available</dd>
              </div>
            )}
          </dl>
        </div>
      </div>
    </header>

    <!-- Case Content -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 p-8 prose prose-lg prose-gray dark:prose-invert max-w-none">
      <Content />
    </div>

    <!-- Documents Section -->
    {caseItem.data.documents && caseItem.data.documents.length > 0 && (
      <div class="mt-8">
        <DocumentsList documents={caseItem.data.documents} />
      </div>
    )}

    <!-- Back to Cases -->
    <div class="mt-8">
      <a 
        href="/cases"
        class="inline-flex items-center text-red-600 dark:text-red-500 hover:text-red-700 dark:hover:text-red-400 font-medium"
      >
        ‚Üê Back to all cases
      </a>
    </div>
  </article>
</MainLayout>